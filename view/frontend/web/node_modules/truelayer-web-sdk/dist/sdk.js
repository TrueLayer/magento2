!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).TrueLayer={})}(this,(function(e){"use strict";function r(){const e=n();return e.style.position="fixed",e.style.bottom="0",e.style.left="0",e.style.right="0",e.style.pointerEvents="none",e}function n(){const e=document.createElement("iframe");return e.height="100%",e.width="100%",e}function o(e){e.style.pointerEvents="auto"}function t(e){e.style.pointerEvents="none"}function a({iframe:e,key:r,payload:n}){var o;null==(o=e.contentWindow)||o.postMessage(JSON.stringify({scope:"[TRUELAYER]",key:r,payload:n,date:Date.now()}),"*")}var c="0.6.0";function i({production:e}){return e?"https://app.truelayer.com":"https://app.truelayer-sandbox.com"}function l(){return c}const s="tl-hpp-next";function u({hppUrl:e,iframe:r,production:n,iframeName:o,checkoutIframe:t}){a({iframe:t,key:"FROM_SDK_DIALOG_IS_RELOADING",payload:{iframeName:o}});const c=new URL(`${i({production:n})}${e}`);c.searchParams.set("iframe_name",o);const s=l();return c.searchParams.set("sdk_version",s),r.src=c.toString(),r}const d="tl-checkout-widget";const p="tl-learn-more";const _=()=>{document.body.style.overflow="hidden"},m=()=>{document.body.style.overflow="auto"},R="tl-hpp-next-account-selection";const E="tl-error-snackbar";var O=Object.defineProperty,f=Object.defineProperties,y=Object.getOwnPropertyDescriptors,C=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,A=(e,r,n)=>r in e?O(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,N=(e,r)=>{for(var n in r||(r={}))h.call(r,n)&&A(e,n,r[n]);if(C)for(var n of C(r))L.call(r,n)&&A(e,n,r[n]);return e};e.initWebSdk=function(e){var c,O=e,{onDone:A,onCancel:P,onError:v,onPayButtonClicked:U,onNavigation:k}=O,S=((e,r)=>{var n={};for(var o in e)h.call(e,o)&&r.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&C)for(var o of C(e))r.indexOf(o)<0&&L.call(e,o)&&(n[o]=e[o]);return n})(O,["onDone","onCancel","onError","onPayButtonClicked","onNavigation"]);let b=null,M=null,T=null,D=null,I=null,g=null;const w={isLearnMoreReady:!1},K=null!=(c=S.production)&&c;function G(e){var n,c,d,O,f,y;if(e.origin===i({production:K})&&e.data)try{let C;try{C=JSON.parse(e.data)}catch(e){}if("[TRUELAYER]"!==C.scope)return;switch(null==C?void 0:C.key){case"FROM_CHECKOUT_PAGE_PRERENDER_HPP_URL":const e=C.payload.hppUrl;T||(T=function({container:e,hppUrl:n,production:o,iframeName:t}){const a=r();a.title="TrueLayer Payment",a.id=s,a.name=s;const c=new URL(`${i({production:o})}${n}`);c.searchParams.set("iframe_name",t);const u=l();return c.searchParams.set("sdk_version",u),a.src=c.toString(),e&&e.appendChild(a),a}({container:b,hppUrl:e,production:K,iframeName:"hpp"}));break;case"FROM_CHECKOUT_PAGE_ON_PAY_BUTTON_CLICKED":_(),null==U||U(),T&&(o(T),a({iframe:T,key:"FROM_SDK_PAGE_OPEN_HPP_URL"}));break;case"FROM_CHECKOUT_PAGE_PRERENDER_LEARN_MORE":const h=C.payload.learnMoreUrl;I||(I=function({container:e,learnMoreUrl:n,production:o}){const t=r();t.title="TrueLayer Learn More",t.id=p,t.name=p;const a=new URL(`${i({production:o})}/${n}`),c=l();return a.searchParams.set("sdk_version",c),t.src=a.toString(),e&&e.appendChild(t),t}({container:b,learnMoreUrl:h,production:K}));break;case"FROM_CHECKOUT_PAGE_PRERENDER_ACCOUNT_SELECTION":const L=C.payload.accountSelectionUrl;D||(D=function({container:e,accountSelectionUrl:n,production:o}){const t=r();t.title="TrueLayer Account Selection",t.id=R,t.name=R;const a=new URL(`${i({production:o})}${n}`);a.searchParams.set("iframe_name","account-selection");const c=l();return a.searchParams.set("sdk_version",c),t.src=a.toString(),e&&e.appendChild(t),t}({container:b,accountSelectionUrl:L,production:K}));break;case"FROM_CHECKOUT_PAGE_PRERENDER_ERROR_SNACKBAR":const N=C.payload.errorUrl;g||(g=function({container:e,errorUrl:n,production:o}){const t=r();t.title="TrueLayer Error",t.id=E,t.name=E;const a=new URL(`${i({production:o})}/${n}`),c=l();return a.searchParams.set("sdk_version",c),a.searchParams.set("iframe_name","error"),t.src=a.toString(),e&&e.appendChild(t),t}({container:b,errorUrl:N,production:K}));break;case"FROM_CHECKOUT_PAGE_ON_PAY_BUTTON_ERROR_CLICKED":if(null==U||U(),g){o(g);const e=new Error("Cannot initialise web sdk");null==v||v(e),a({iframe:g,key:"FROM_SDK_OPEN_ERROR_SNACKBAR"})}break;case"FROM_ERROR_SNACKBAR_ERROR_SNACKBAR_DISAPPEARED":case"FROM_ERROR_SNACKBAR_ON_CLOSE_ICON_CLICKED":M&&a({iframe:M,key:null==C?void 0:C.key}),g&&t(g),m();break;case"FROM_CHECKOUT_PAGE_LEARN_MORE_BUTTON_CLICKED":_(),I&&(o(I),a({iframe:I,key:"FROM_SDK_OPEN_LEARN_MORE"}));break;case"FROM_CHECKOUT_PAGE_ACCOUNT_SELECTION_BUTTON_CLICKED":_(),D&&(o(D),a({iframe:D,key:"FROM_SDK_OPEN_ACCOUNT_SELECTION"}));break;case"FROM_CHECKOUT_PAGE_NAVIGATE_TO_PAGE":null==k||k(C.payload.page);break;case"FROM_DIALOG_PAGE_CLOSE_LEARN_MORE":I&&t(I),m();break;case"FROM_DIALOG_PAGE_CLOSE_ACCOUNT_SELECTION":{const e=null==(n=C.payload)?void 0:n.hppUrl;D&&t(D),T&&(t(T),e&&M&&u({iframe:T,hppUrl:e,production:K,iframeName:"hpp",checkoutIframe:M})),m();break}case"FROM_DIALOG_PAGE_ON_DONE":const S=C.payload.resultStatus;m(),null==A||A({resultStatus:S}),null==T||T.remove(),null==D||D.remove(),null==I||I.remove(),null==M||M.remove(),null==g||g.remove();break;case"FROM_DIALOG_PAGE_ON_CANCEL":{if(M){const e=new URL(M.src);e.searchParams.set("reloaded","true"),M.src=e.toString()}const e=null==(c=C.payload)?void 0:c.hppUrl,r=null==(d=C.payload)?void 0:d.accountSelectionUrl;D&&(t(D),r&&M&&u({iframe:D,hppUrl:r,production:K,iframeName:"account-selection",checkoutIframe:M}),void 0===r&&D.remove()),T&&(t(T),e&&M&&u({iframe:T,hppUrl:e,production:K,iframeName:"hpp",checkoutIframe:M})),m(),null==P||P();break}case"FROM_DIALOG_ON_ERROR":const G=null==(O=C.payload)?void 0:O.error,F=new Error(G.message);F.name=G.type,null==v||v(F);break;case"FROM_DIALOG_REDIRECT_TO_PROVIDER":const H=C.payload.bankUri,B=window.open(H,"_blank");null==B||B.focus();break;case"FROM_DIALOG_IS_READY":"learn-more"===(null==(f=C.payload)?void 0:f.iframeName)&&(w.isLearnMoreReady=!0),M&&a({iframe:M,key:"FROM_SDK_DIALOG_IS_READY",payload:{iframeName:null==(y=C.payload)?void 0:y.iframeName}})}}catch(e){console.error(e)}}const F=e=>{var r;return M&&function({paymentId:e,resourceToken:r,checkoutIframe:n}){const o=new URL(n.src);o.searchParams.append("payment_id",e),o.searchParams.append("resource_token",r),n.src=o.toString()}((r=N({},e),f(r,y({checkoutIframe:M})))),{cleanup:H}},H=()=>window.removeEventListener("message",G);return{mount:e=>(b=e,M=function({container:e,uiSettings:r,production:o}){var t;e&&(e.innerHTML="");const a=n();a.title="TrueLayer WebSDK",a.id=d,a.name=d;const c=new URL(i({production:o})+"/embedded/checkout"),s=new URLSearchParams,u=l();return s.append("sdk_version",u),(null==r?void 0:r.recommendedPaymentMethod)&&s.append("recommended","true"),void 0!==(null==r?void 0:r.borderRadius)&&s.append("borderRadius",String(r.borderRadius)),s.append("size",null!=(t=null==r?void 0:r.size)?t:"large"),(null==r?void 0:r.merchantLogoUri)&&s.append("merchant_logo_uri",r.merchantLogoUri),c.search=s.toString(),a.src=c.toString(),e&&e.appendChild(a),a}(N({container:e,production:K},S)),window.addEventListener("message",G),{start:F,cleanup:H}),start:F,cleanup:H,openLearnMoreModal:()=>{function e(){r&&clearInterval(r),I&&(o(I),a({iframe:I,key:"FROM_SDK_OPEN_LEARN_MORE"}))}let r=null;w.isLearnMoreReady?e():r=setInterval((()=>{w.isLearnMoreReady&&e()}),100)}}},Object.defineProperty(e,"__esModule",{value:!0})}));
