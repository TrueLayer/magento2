!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("truelayer-embedded-payment-page")):"function"==typeof define&&define.amd?define(["exports","truelayer-embedded-payment-page"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).TrueLayer={},e.truelayerEmbeddedPaymentPage)}(this,(function(e,r){"use strict";function n(){const e=o();return e.style.position="fixed",e.style.bottom="0",e.style.left="0",e.style.right="0",e.style.zIndex="9999",e.style.pointerEvents="none",e}function o(){const e=document.createElement("iframe");return e.height="100%",e.width="100%",e}function t(e){e.style.pointerEvents="auto"}function a(e){e.style.pointerEvents="none"}function c({iframe:e,key:r,payload:n}){var o;null==(o=e.contentWindow)||o.postMessage(JSON.stringify({scope:"[TRUELAYER]",key:r,payload:n,date:Date.now()}),"*")}var i="0.6.4";function l({production:e}){return e?"https://app.truelayer.com":"https://app.truelayer-sandbox.com"}function s(e){const r=i;return e.searchParams.set("sdk_version",r),e}function u(e){const{production:r,url:n}=e;return s(new URL(`${l({production:r})}${n}`))}const _="tl-hpp-next";function d({hppUrl:e,iframe:r,production:n,iframeName:o,checkoutIframe:t}){c({iframe:t,key:"FROM_SDK_DIALOG_IS_RELOADING",payload:{iframeName:o}});const a=u({production:n,url:e});return a.searchParams.set("iframe_name",o),r.src=a.toString(),r}const p="tl-checkout-widget";const m="tl-learn-more";const E=()=>{document.body.style.overflow="hidden"},O=()=>{document.body.style.overflow="auto"},R="tl-hpp-next-account-selection";const f="tl-error-snackbar";var y=Object.defineProperty,C=Object.defineProperties,P=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,A=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable,b=(e,r,n)=>r in e?y(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,L=(e,r)=>{for(var n in r||(r={}))A.call(r,n)&&b(e,n,r[n]);if(h)for(var n of h(r))N.call(r,n)&&b(e,n,r[n]);return e};e.initWebSdk=function(e){var i,s=e,{onDone:y,onCancel:b,onError:k,onPayButtonClicked:U,onNavigation:v}=s,S=((e,r)=>{var n={};for(var o in e)A.call(e,o)&&r.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&h)for(var o of h(e))r.indexOf(o)<0&&N.call(e,o)&&(n[o]=e[o]);return n})(s,["onDone","onCancel","onError","onPayButtonClicked","onNavigation"]);let M=null,T=null,D=null,I=null,g=null,K=null;const F={isLearnMoreReady:!1},G=null!=(i=S.production)&&i;function w(e){var o,i,s,p,C,P;if(e.origin===l({production:G})&&e.data)try{let l;try{l=JSON.parse(e.data)}catch(e){}if("[TRUELAYER]"!==l.scope)return;switch(null==l?void 0:l.key){case"FROM_CHECKOUT_PAGE_PRERENDER_HPP_URL":const e=l.payload.hppUrl;D||(D=function({container:e,hppUrl:r,production:o,iframeName:t}){const a=n();a.title="TrueLayer Payment",a.id=_,a.name=_;const c=u({production:o,url:r});return c.searchParams.set("iframe_name",t),a.src=c.toString(),e&&e.appendChild(a),a}({container:M,hppUrl:e,production:G,iframeName:"hpp"}));break;case"FROM_CHECKOUT_PAGE_ON_PAY_BUTTON_CLICKED":E(),null==U||U(),D&&(t(D),c({iframe:D,key:"FROM_SDK_PAGE_OPEN_HPP_URL"}));break;case"FROM_CHECKOUT_PAGE_ON_EPP_PAY_BUTTON_CLICKED":E(),null==U||U();const{payment_id:h,resource_token:A,return_uri:N}=l.payload;r.Payment({payment_id:h,resource_token:A,open_bank_in_new_tab:!0,return_uri:N,production:G,onAbort:b,onDone:()=>{null==y||y({resultStatus:"success"})},onError(e){null==k||k(e)},extra_hash_params:{is_web_sdk_fallback:!0}}).start();break;case"FROM_CHECKOUT_PAGE_PRERENDER_LEARN_MORE":const L=l.payload.learnMoreUrl;g||(g=function({container:e,learnMoreUrl:r,production:o}){const t=n();t.title="TrueLayer Learn More",t.id=m,t.name=m;const a=u({production:o,url:r});return t.src=a.toString(),e&&e.appendChild(t),t}({container:M,learnMoreUrl:L,production:G}));break;case"FROM_CHECKOUT_PAGE_PRERENDER_ACCOUNT_SELECTION":const S=l.payload.accountSelectionUrl;I||(I=function({container:e,accountSelectionUrl:r,production:o}){const t=n();t.title="TrueLayer Account Selection",t.id=R,t.name=R;const a=u({production:o,url:r});return a.searchParams.set("iframe_name","account-selection"),t.src=a.toString(),e&&e.appendChild(t),t}({container:M,accountSelectionUrl:S,production:G}));break;case"FROM_CHECKOUT_PAGE_PRERENDER_ERROR_SNACKBAR":const w=l.payload.errorUrl;K||(K=function({container:e,errorUrl:r,production:o}){const t=n();t.title="TrueLayer Error",t.id=f,t.name=f;const a=u({production:o,url:r});return a.searchParams.set("iframe_name","error"),t.src=a.toString(),e&&e.appendChild(t),t}({container:M,errorUrl:w,production:G}));break;case"FROM_CHECKOUT_PAGE_ON_PAY_BUTTON_ERROR_CLICKED":if(null==U||U(),K){t(K);const e=new Error("Cannot initialise web sdk");null==k||k(e),c({iframe:K,key:"FROM_SDK_OPEN_ERROR_SNACKBAR"})}break;case"FROM_ERROR_SNACKBAR_ERROR_SNACKBAR_DISAPPEARED":case"FROM_ERROR_SNACKBAR_ON_CLOSE_ICON_CLICKED":T&&c({iframe:T,key:null==l?void 0:l.key}),K&&a(K),O();break;case"FROM_CHECKOUT_PAGE_LEARN_MORE_BUTTON_CLICKED":E(),g&&(t(g),c({iframe:g,key:"FROM_SDK_OPEN_LEARN_MORE"}));break;case"FROM_CHECKOUT_PAGE_ACCOUNT_SELECTION_BUTTON_CLICKED":E(),I&&(t(I),c({iframe:I,key:"FROM_SDK_OPEN_ACCOUNT_SELECTION"}));break;case"FROM_CHECKOUT_PAGE_NAVIGATE_TO_PAGE":null==v||v(l.payload.page);break;case"FROM_DIALOG_PAGE_CLOSE_LEARN_MORE":g&&a(g),O();break;case"FROM_DIALOG_PAGE_CLOSE_ACCOUNT_SELECTION":{const e=null==(o=l.payload)?void 0:o.hppUrl;I&&a(I),D&&(a(D),e&&T&&d({iframe:D,hppUrl:e,production:G,iframeName:"hpp",checkoutIframe:T})),O();break}case"FROM_DIALOG_PAGE_ON_DONE":const x=l.payload.resultStatus;O(),null==y||y({resultStatus:x}),null==D||D.remove(),null==I||I.remove(),null==g||g.remove(),null==T||T.remove(),null==K||K.remove();break;case"FROM_DIALOG_PAGE_ON_CANCEL":{if(T){const e=new URL(T.src);e.searchParams.set("reloaded","true"),T.src=e.toString()}const e=null==(i=l.payload)?void 0:i.hppUrl,r=null==(s=l.payload)?void 0:s.accountSelectionUrl;I&&(a(I),r&&T&&d({iframe:I,hppUrl:r,production:G,iframeName:"account-selection",checkoutIframe:T}),void 0===r&&I.remove()),D&&(a(D),e&&T&&d({iframe:D,hppUrl:e,production:G,iframeName:"hpp",checkoutIframe:T})),O(),null==b||b();break}case"FROM_DIALOG_ON_ERROR":const H=null==(p=l.payload)?void 0:p.error,B=new Error(H.message);B.name=H.type,null==k||k(B);break;case"FROM_DIALOG_REDIRECT_TO_PROVIDER":const j=l.payload.bankUri,Y=window.open(j,"_blank");null==Y||Y.focus();break;case"FROM_DIALOG_IS_READY":"learn-more"===(null==(C=l.payload)?void 0:C.iframeName)&&(F.isLearnMoreReady=!0),T&&c({iframe:T,key:"FROM_SDK_DIALOG_IS_READY",payload:{iframeName:null==(P=l.payload)?void 0:P.iframeName}})}}catch(e){console.error(e)}}const x=e=>{var r;return T&&function({paymentId:e,resourceToken:r,checkoutIframe:n}){const o=new URL(n.src);o.searchParams.append("payment_id",e),o.searchParams.append("resource_token",r),n.src=o.toString()}((r=L({},e),C(r,P({checkoutIframe:T})))),{cleanup:H}},H=()=>window.removeEventListener("message",w);return{mount:e=>(M=e,T=function({container:e,uiSettings:r,production:n,maxWaitForResult:t}){var a;e&&(e.innerHTML="");const c=o();c.title="TrueLayer WebSDK",c.id=p,c.name=p;const i=u({production:n,url:"/embedded/checkout"});return(null==r?void 0:r.recommendedPaymentMethod)&&i.searchParams.set("recommended","true"),void 0!==(null==r?void 0:r.borderRadius)&&i.searchParams.set("borderRadius",String(r.borderRadius)),i.searchParams.set("size",null!=(a=null==r?void 0:r.size)?a:"large"),(null==r?void 0:r.merchantLogoUri)&&i.searchParams.set("merchant_logo_uri",r.merchantLogoUri),t&&i.searchParams.set("max_wait_for_result",String(t)),c.src=i.toString(),e&&e.appendChild(c),c}(L({container:e,production:G},S)),window.addEventListener("message",w),{start:x,cleanup:H}),start:x,cleanup:H,openLearnMoreModal:()=>{function e(){r&&clearInterval(r),g&&(t(g),c({iframe:g,key:"FROM_SDK_OPEN_LEARN_MORE"}))}let r=null;F.isLearnMoreReady?e():r=setInterval((()=>{F.isLearnMoreReady&&e()}),100)}}},Object.defineProperty(e,"__esModule",{value:!0})}));
