function e(){const e=r();return e.style.position="fixed",e.style.bottom="0",e.style.left="0",e.style.right="0",e.style.pointerEvents="none",e}function r(){const e=document.createElement("iframe");return e.height="100%",e.width="100%",e}function n(e){e.style.pointerEvents="auto"}function o(e){e.style.pointerEvents="none"}function a({iframe:e,key:r,payload:n}){var o;null==(o=e.contentWindow)||o.postMessage(JSON.stringify({scope:"[TRUELAYER]",key:r,payload:n,date:Date.now()}),"*")}var t="0.6.0";function c({production:e}){return e?"https://app.truelayer.com":"https://app.truelayer-sandbox.com"}function i(){return t}const l="tl-hpp-next";function s({hppUrl:e,iframe:r,production:n,iframeName:o,checkoutIframe:t}){a({iframe:t,key:"FROM_SDK_DIALOG_IS_RELOADING",payload:{iframeName:o}});const l=new URL(`${c({production:n})}${e}`);l.searchParams.set("iframe_name",o);const s=i();return l.searchParams.set("sdk_version",s),r.src=l.toString(),r}const u="tl-checkout-widget";const _="tl-learn-more";const d=()=>{document.body.style.overflow="hidden"},p=()=>{document.body.style.overflow="auto"},R="tl-hpp-next-account-selection";const m="tl-error-snackbar";var E=Object.defineProperty,O=Object.defineProperties,f=Object.getOwnPropertyDescriptors,y=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,h=(e,r,n)=>r in e?E(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,A=(e,r)=>{for(var n in r||(r={}))C.call(r,n)&&h(e,n,r[n]);if(y)for(var n of y(r))L.call(r,n)&&h(e,n,r[n]);return e};function N(t){var E,h=t,{onDone:N,onCancel:P,onError:U,onPayButtonClicked:v,onNavigation:k}=h,S=((e,r)=>{var n={};for(var o in e)C.call(e,o)&&r.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&y)for(var o of y(e))r.indexOf(o)<0&&L.call(e,o)&&(n[o]=e[o]);return n})(h,["onDone","onCancel","onError","onPayButtonClicked","onNavigation"]);let M=null,b=null,D=null,T=null,I=null,g=null;const w={isLearnMoreReady:!1},K=null!=(E=S.production)&&E;function G(r){var t,u,E,O,f,y;if(r.origin===c({production:K})&&r.data)try{let C;try{C=JSON.parse(r.data)}catch(e){}if("[TRUELAYER]"!==C.scope)return;switch(null==C?void 0:C.key){case"FROM_CHECKOUT_PAGE_PRERENDER_HPP_URL":const r=C.payload.hppUrl;D||(D=function({container:r,hppUrl:n,production:o,iframeName:a}){const t=e();t.title="TrueLayer Payment",t.id=l,t.name=l;const s=new URL(`${c({production:o})}${n}`);s.searchParams.set("iframe_name",a);const u=i();return s.searchParams.set("sdk_version",u),t.src=s.toString(),r&&r.appendChild(t),t}({container:M,hppUrl:r,production:K,iframeName:"hpp"}));break;case"FROM_CHECKOUT_PAGE_ON_PAY_BUTTON_CLICKED":d(),null==v||v(),D&&(n(D),a({iframe:D,key:"FROM_SDK_PAGE_OPEN_HPP_URL"}));break;case"FROM_CHECKOUT_PAGE_PRERENDER_LEARN_MORE":const L=C.payload.learnMoreUrl;I||(I=function({container:r,learnMoreUrl:n,production:o}){const a=e();a.title="TrueLayer Learn More",a.id=_,a.name=_;const t=new URL(`${c({production:o})}/${n}`),l=i();return t.searchParams.set("sdk_version",l),a.src=t.toString(),r&&r.appendChild(a),a}({container:M,learnMoreUrl:L,production:K}));break;case"FROM_CHECKOUT_PAGE_PRERENDER_ACCOUNT_SELECTION":const h=C.payload.accountSelectionUrl;T||(T=function({container:r,accountSelectionUrl:n,production:o}){const a=e();a.title="TrueLayer Account Selection",a.id=R,a.name=R;const t=new URL(`${c({production:o})}${n}`);t.searchParams.set("iframe_name","account-selection");const l=i();return t.searchParams.set("sdk_version",l),a.src=t.toString(),r&&r.appendChild(a),a}({container:M,accountSelectionUrl:h,production:K}));break;case"FROM_CHECKOUT_PAGE_PRERENDER_ERROR_SNACKBAR":const A=C.payload.errorUrl;g||(g=function({container:r,errorUrl:n,production:o}){const a=e();a.title="TrueLayer Error",a.id=m,a.name=m;const t=new URL(`${c({production:o})}/${n}`),l=i();return t.searchParams.set("sdk_version",l),t.searchParams.set("iframe_name","error"),a.src=t.toString(),r&&r.appendChild(a),a}({container:M,errorUrl:A,production:K}));break;case"FROM_CHECKOUT_PAGE_ON_PAY_BUTTON_ERROR_CLICKED":if(null==v||v(),g){n(g);const e=new Error("Cannot initialise web sdk");null==U||U(e),a({iframe:g,key:"FROM_SDK_OPEN_ERROR_SNACKBAR"})}break;case"FROM_ERROR_SNACKBAR_ERROR_SNACKBAR_DISAPPEARED":case"FROM_ERROR_SNACKBAR_ON_CLOSE_ICON_CLICKED":b&&a({iframe:b,key:null==C?void 0:C.key}),g&&o(g),p();break;case"FROM_CHECKOUT_PAGE_LEARN_MORE_BUTTON_CLICKED":d(),I&&(n(I),a({iframe:I,key:"FROM_SDK_OPEN_LEARN_MORE"}));break;case"FROM_CHECKOUT_PAGE_ACCOUNT_SELECTION_BUTTON_CLICKED":d(),T&&(n(T),a({iframe:T,key:"FROM_SDK_OPEN_ACCOUNT_SELECTION"}));break;case"FROM_CHECKOUT_PAGE_NAVIGATE_TO_PAGE":null==k||k(C.payload.page);break;case"FROM_DIALOG_PAGE_CLOSE_LEARN_MORE":I&&o(I),p();break;case"FROM_DIALOG_PAGE_CLOSE_ACCOUNT_SELECTION":{const e=null==(t=C.payload)?void 0:t.hppUrl;T&&o(T),D&&(o(D),e&&b&&s({iframe:D,hppUrl:e,production:K,iframeName:"hpp",checkoutIframe:b})),p();break}case"FROM_DIALOG_PAGE_ON_DONE":const S=C.payload.resultStatus;p(),null==N||N({resultStatus:S}),null==D||D.remove(),null==T||T.remove(),null==I||I.remove(),null==b||b.remove(),null==g||g.remove();break;case"FROM_DIALOG_PAGE_ON_CANCEL":{if(b){const e=new URL(b.src);e.searchParams.set("reloaded","true"),b.src=e.toString()}const e=null==(u=C.payload)?void 0:u.hppUrl,r=null==(E=C.payload)?void 0:E.accountSelectionUrl;T&&(o(T),r&&b&&s({iframe:T,hppUrl:r,production:K,iframeName:"account-selection",checkoutIframe:b}),void 0===r&&T.remove()),D&&(o(D),e&&b&&s({iframe:D,hppUrl:e,production:K,iframeName:"hpp",checkoutIframe:b})),p(),null==P||P();break}case"FROM_DIALOG_ON_ERROR":const G=null==(O=C.payload)?void 0:O.error,F=new Error(G.message);F.name=G.type,null==U||U(F);break;case"FROM_DIALOG_REDIRECT_TO_PROVIDER":const H=C.payload.bankUri,B=window.open(H,"_blank");null==B||B.focus();break;case"FROM_DIALOG_IS_READY":"learn-more"===(null==(f=C.payload)?void 0:f.iframeName)&&(w.isLearnMoreReady=!0),b&&a({iframe:b,key:"FROM_SDK_DIALOG_IS_READY",payload:{iframeName:null==(y=C.payload)?void 0:y.iframeName}})}}catch(e){console.error(e)}}const F=e=>{var r;return b&&function({paymentId:e,resourceToken:r,checkoutIframe:n}){const o=new URL(n.src);o.searchParams.append("payment_id",e),o.searchParams.append("resource_token",r),n.src=o.toString()}((r=A({},e),O(r,f({checkoutIframe:b})))),{cleanup:H}},H=()=>window.removeEventListener("message",G);return{mount:e=>(M=e,b=function({container:e,uiSettings:n,production:o}){var a;e&&(e.innerHTML="");const t=r();t.title="TrueLayer WebSDK",t.id=u,t.name=u;const l=new URL(c({production:o})+"/embedded/checkout"),s=new URLSearchParams,_=i();return s.append("sdk_version",_),(null==n?void 0:n.recommendedPaymentMethod)&&s.append("recommended","true"),void 0!==(null==n?void 0:n.borderRadius)&&s.append("borderRadius",String(n.borderRadius)),s.append("size",null!=(a=null==n?void 0:n.size)?a:"large"),(null==n?void 0:n.merchantLogoUri)&&s.append("merchant_logo_uri",n.merchantLogoUri),l.search=s.toString(),t.src=l.toString(),e&&e.appendChild(t),t}(A({container:e,production:K},S)),window.addEventListener("message",G),{start:F,cleanup:H}),start:F,cleanup:H,openLearnMoreModal:()=>{function e(){r&&clearInterval(r),I&&(n(I),a({iframe:I,key:"FROM_SDK_OPEN_LEARN_MORE"}))}let r=null;w.isLearnMoreReady?e():r=setInterval((()=>{w.isLearnMoreReady&&e()}),100)}}}export{N as initWebSdk};
